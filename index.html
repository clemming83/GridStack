<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GoWish Grid POC</title>

  <!-- Gridstack CSS -->
  <link href="https://cdn.jsdelivr.net/npm/gridstack@10.3.1/dist/gridstack.min.css" rel="stylesheet"/>

  <!-- Prefer the full bundle to avoid browser DnD quirks -->
  <script src="https://cdn.jsdelivr.net/npm/gridstack@10.3.1/dist/gridstack-all.js"></script>

  <style>
    :root { --bg:#f5f5f7; --btn:#007aff; --btnh:#005ecb; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin:0; }
    h1 { text-align:center; margin:16px 0 8px; font-weight:600; }
    .toolbar { display:flex; justify-content:center; gap:10px; margin: 0 0 10px; }
    button { background:var(--btn); color:#fff; border:0; border-radius:8px; padding:8px 14px; cursor:pointer; font-size:14px; }
    button:hover { background:var(--btnh); }
    .grid-stack { margin: 0 auto 40px; max-width:1200px; }
    .grid-stack-item-content {
      background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.1);
      display:flex; flex-direction:column; align-items:center; overflow:hidden; transition:transform .1s ease;
    }
    .grid-stack-item-content:hover { transform: scale(1.02); }
    .product-card img { width:100%; height:180px; object-fit:cover; border-bottom:1px solid #eee; display:block; }
    .product-card .title { font-size:15px; font-weight:600; text-align:center; margin:8px 8px 4px; }
    .product-card .price { color:#555; font-size:14px; margin:0 0 10px; }
    #errbox {
      display:none; max-width:1100px; margin:16px auto; padding:12px 14px; background:#ffe6e6; color:#900;
      border:1px solid #f5b5b5; border-radius:8px; white-space:pre-wrap; line-height:1.35;
    }
  </style>
</head>
<body>
  <h1>üéÅ GoWish √ònskeliste Grid (POC)</h1>
  <div class="toolbar">
    <button id="saveBtn">üíæ Gem layout</button>
    <button id="resetBtn">üîÑ Nulstil</button>
  </div>

  <div id="errbox"></div>
  <div class="grid-stack"></div>

  <script>
    (function () {
      const errbox = document.getElementById('errbox');
      function showError(msg, e) {
        errbox.style.display = 'block';
        errbox.textContent = '[FEJL] ' + msg + (e ? '\n' + (e.stack || e.message || e) : '');
      }

      function ready(fn){ document.readyState !== 'loading' ? fn() : document.addEventListener('DOMContentLoaded', fn); }

      ready(function () {
        try {
          if (!window.GridStack) {
            showError('GridStack er ikke defineret. CDN kunne ikke indl√¶ses. Pr√∏v at reload siden eller tjek netv√¶rket.');
            return;
          }

          const products = [
            { title: "HAY ‚Äì Recycled Vase", price: "299 kr",
              img:"https://via.placeholder.com/400x300/CCE5FF/000000?text=HAY+Vase", url:"https://gowish.com/da/product/1" },
            { title: "LEGO Icons Flower Bouquet", price: "449 kr",
              img:"https://via.placeholder.com/400x300/FFD8A8/000000?text=LEGO+Bouquet", url:"https://gowish.com/da/product/2" },
            { title: "Apple AirPods Pro (2. gen)", price: "1.899 kr",
              img:"https://via.placeholder.com/400x300/E0BBE4/000000?text=AirPods+Pro", url:"https://gowish.com/da/product/3" },
            { title: "K√§hler Hammersh√∏i Lysestage", price: "249 kr",
              img:"https://via.placeholder.com/400x300/FEC8D8/000000?text=Lysestage", url:"https://gowish.com/da/product/4" },
            { title: "Georg Jensen Sky Karaffel", price: "699 kr",
              img:"https://via.placeholder.com/400x300/C8E7D1/000000?text=Sky+Karaffel", url:"https://gowish.com/da/product/5" },
          ];

          let grid;
          try {
            grid = GridStack.init({ float:true, cellHeight:260, column:6, margin:10 });
          } catch (e) {
            showError('Kunne ikke initialisere GridStack.', e);
            return;
          }

          try {
            products.forEach((p, idx) => {
              const el = document.createElement('div');
              el.className = 'grid-stack-item';
              el.setAttribute('gs-x', (idx * 2) % 6);
              el.setAttribute('gs-y', Math.floor(idx / 3) * 2);
              el.setAttribute('gs-w', 2);
              el.setAttribute('gs-h', 2);

              const content = document.createElement('div');
              content.className = 'grid-stack-item-content product-card';
              content.innerHTML = `
                <a href="${p.url}" target="_blank" rel="noopener">
                  <img src="${p.img}" alt="${p.title}" />
                </a>
                <div class="title">${p.title}</div>
                <div class="price">${p.price}</div>
              `;
              el.appendChild(content);
              grid.addWidget(el);
            });
          } catch (e) {
            showError('Kunne ikke tilf√∏je widgets til griddet.', e);
            return;
          }

          // Save / Reset
          document.getElementById('saveBtn').addEventListener('click', function(){
            try {
              const data = grid.save(false);
              localStorage.setItem('gowishLayout', JSON.stringify(data));
              alert('Layout gemt!');
            } catch (e) {
              showError('Kunne ikke gemme layout.', e);
            }
          });
          document.getElementById('resetBtn').addEventListener('click', function(){
            try {
              localStorage.removeItem('gowishLayout');
              location.reload();
            } catch (e) {
              showError('Kunne ikke nulstille layout.', e);
            }
          });

        } catch (e) {
          showError('Uventet fejl i initialisering.', e);
        }
      });
    })();
  </script>
</body>
</html>
